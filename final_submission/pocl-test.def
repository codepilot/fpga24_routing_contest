BootStrap: docker
From: ubuntu:22.04

%post
    apt update
    apt install -y wget
	wget -qO- https://github.com/Kitware/CMake/releases/download/v3.28.1/cmake-3.28.1-linux-x86_64.tar.gz | tar xz --strip-components=1 -C /usr
    cmake --help


    export LLVM_VERSION=17
    apt update
	apt -y install software-properties-common
    add-apt-repository 'deb [trusted=yes] http://apt.llvm.org/jammy/ llvm-toolchain-jammy main'
    add-apt-repository 'deb [trusted=yes] http://apt.llvm.org/jammy/ llvm-toolchain-jammy-17 main'
    add-apt-repository 'deb [trusted=yes] http://apt.llvm.org/jammy/ llvm-toolchain-jammy-18 main'
    add-apt-repository 'deb-src [trusted=yes] http://apt.llvm.org/jammy/ llvm-toolchain-jammy main'
    add-apt-repository 'deb-src [trusted=yes] http://apt.llvm.org/jammy/ llvm-toolchain-jammy-17 main'
    add-apt-repository 'deb-src [trusted=yes] http://apt.llvm.org/jammy/ llvm-toolchain-jammy-18 main'
    apt update
    apt install -y wget python3-dev libpython3-dev build-essential ocl-icd-libopencl1 git pkg-config libclang-${LLVM_VERSION}-dev clang-${LLVM_VERSION} llvm-${LLVM_VERSION} make ninja-build ocl-icd-libopencl1 ocl-icd-dev ocl-icd-opencl-dev libhwloc-dev zlib1g zlib1g-dev clinfo dialog apt-utils libxml2-dev libclang-cpp${LLVM_VERSION}-dev libclang-cpp${LLVM_VERSION} llvm-${LLVM_VERSION}-dev
    git clone https://github.com/pocl/pocl.git
    cd pocl
    mkdir build
    cd build
    cmake -DENABLE_ICD=TRUE ..
    make -j && make install
    clinfo
